<!DOCTYPE=html>
<head>
<style>
</style>
<title> Kateva pohja </title>
<body>
<canvas id="CanvasId" width="900" height="900"></canvas>
<input type="button" id="but0" value="pelaaja vs. pelaaja" onmousedown="keypress(48)">
<input type="button" id="but1" value="pelaaja vs. botti" onmousedown="keypress(49)">
<input type="button" id="but2" value="botti vs. pelaaja" onmousedown="keypress(50)">
<input type="button" id="but3" value="botti vs. botti" onmousedown="keypress(51)">
<h1 id="turn">Valitse pelitilasi</h1>
<script text="text/javascript">
var CanvasElement=document.getElementById("CanvasId");
if(CanvasElement.getContext){
	var ctx = CanvasElement.getContext("2d");
}
var asap=9;
var begin=false;
var pix=100;
var lx=0;
var limit=400;
var vuoromaara=0;
var ly=0;
var win=false;
var bot=new Array(true,true);
var winner=0;
var alue=new Array(asap);
var turn=false;
var reason="";
var teksti="850000012850000012850000012750000013750000013750000013650000014650000014650000014";
var num="012345678"
var vuoro=0;
var opshulen=288;
var opshuns= new Array(opshulen);
for(i=0;i<opshulen;i++){
	opshuns[i]=new Array(0,0,0,0,0);
}
// lähto x lähtö y saapumis x saapumis y luokka oikeako
// luokat : 0 ei mitään erityistä luokka 1 syö
var col=new Array("grey","black","red","blue","darkorange","white","pink","lightblue","yellow");
for(i=0;i<asap;i++){
	alue[i]=new Array(asap)
	for(j=0;j<asap;j++){
		alue[i][j]=num.indexOf(teksti.charAt(i*asap+j))-1
		//alue[i][j]=Math.floor(Math.random()*8)
	}
}
var placo=new Array("valkoinen","musta")
function bol(a){
	if(a){return 1;}
	return 0;
}
function piirra(){
	if(win&false){
		ctx.clearRect(0,0,500,500);
		return;
	}
	ctx.fillStyle="brown";
	ctx.fillRect(0,0,asap*pix,asap*pix);
	for(i=0;i<asap;i++){
		for(j=0;j<asap;j++){
			ctx.fillStyle=col[alue[i][j]+1];
			ctx.fillRect(i*pix,j*pix,pix-1,pix-1);
		}
	}
}
function safloo(a,b){
	if(a<0||b<0||a>asap-1||b>asap-1){return -2;}
	return alue[a][b];
}
function lol(a,b){
	if(safloo(a,b)==2||safloo(a,b)==3){return true;}
	return false;
}
function neig(a,b,c){
	return bol(safloo(a-1,b)==c)+bol(safloo(a+1,b)==c)+bol(safloo(a,b-1)==c)+bol(safloo(a,b+1)==c);
}
function vieri(a,b,c){
	if(safloo(a-1,b)%4==c||safloo(a+1,b)%4==c||safloo(a,b-1)%4==c||safloo(a,b+1)%4==c){
		return true;
	}
	return false;
}
function drawmoves(a,b){
	ctx.fillStyle="green"
	for(i=0;i<asap;i++){
		for(j=0;j<asap;j++){
			if(legal(a,b,i,j)){
				ctx.fillRect(i*pix+7,j*pix+7,pix-15,pix-15);
			}
		}
	}
}
function legal(a,b,c,d){
	var e=alue[a][b]
	if(e%4==1||(vieri(a,b,1)&e%4==0)){
		if((Math.abs(a-c)==1&Math.abs(b-d)==0)||(Math.abs(a-c)==0&Math.abs(b-d)==1)){
			if(alue[c][d]==-1){
				return true;
			}
			if(Math.floor(alue[c][d]/4)==1-bol(turn)&e%4==0){
				return true;
			}
		}
	}
	if(e%4==2||(vieri(a,b,2)&e%4==0)){
		if(Math.abs(a-c)==1&Math.abs(b-d)==1){
			if(alue[c][d]==-1){
				return true;
			}
			if(Math.floor(alue[c][d]/4)==1-bol(turn)&e%4==0){
				return true;
			}
		}
	}
	if(e%4==3||(vieri(a,b,3)&e%4==0)){
		if((Math.abs(a-c)==1&Math.abs(b-d)==2)||(Math.abs(a-c)==2&Math.abs(b-d)==1)){
			if(alue[c][d]==-1){
				return true;
			}
			if(Math.floor(alue[c][d]/4)==1-bol(turn)&e%4==0){
				return true;
			}
		}
	}
	return false;
}
CanvasElement.addEventListener("mousedown",liiku);
function keypress(e){
	if(begin){
		return;
	}
	if(e>47&e<52){
		if(e<50){
			bot[0]=false;
		}
		if(e%2==0){
			bot[1]=false;
		}
		if(bot[bol(turn)]){
			liikutaai();
		}
		document.getElementById("turn").innerHTML="On vuoro numero "+vuoromaara
		document.getElementById("but0").hidden=true;
		document.getElementById("but1").hidden=true;
		document.getElementById("but2").hidden=true;
		document.getElementById("but3").hidden=true;
		begin=true;
		piirra()
	}
}
function liiku(e){
	ctx.fillRect(0,0,500,500)
}
</script>
</body>
</head>